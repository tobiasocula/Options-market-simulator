
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
        <link rel="next" href="application/">
      
      
        
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Options Sim</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL(".",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#hawkes-self-exciting-process" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="." title="Options Sim" class="md-header__button md-logo" aria-label="Options Sim" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Options Sim
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Home
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="." title="Options Sim" class="md-nav__button md-logo" aria-label="Options Sim" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Options Sim
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="." class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hawkes-self-exciting-process" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hawkes self-exciting process
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#order-volume" class="md-nav__link">
    <span class="md-ellipsis">
      
        Order volume
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#buy-and-limit-order-probability-distributions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Buy and limit order probability distributions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Analysis
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hawkes-cross-exciting-process" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hawkes cross-exciting process
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="application/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Application
  

    
  </span>
  
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#hawkes-self-exciting-process" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hawkes self-exciting process
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#order-volume" class="md-nav__link">
    <span class="md-ellipsis">
      
        Order volume
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#buy-and-limit-order-probability-distributions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Buy and limit order probability distributions
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#analysis" class="md-nav__link">
    <span class="md-ellipsis">
      
        Analysis
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#hawkes-cross-exciting-process" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hawkes cross-exciting process
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



  <h1>Home</h1>

<div class="grid cards">
<ul>
<li>
<p><img alt="Frequency of trades analysis" src="assets/image.png" /></p>
</li>
<li>
<p><img alt="Intensity of orders heatmap" src="assets/image2.png" /></p>
</li>
</ul>
</div>
<h3 id="hawkes-self-exciting-process">Hawkes self-exciting process</h3>
<p>We will use the standard Hawkes process formula described on the wiki.</p>
<div class="arithmatex">\[\begin{equation}
\lambda_i(t)=\mu\cdot\text{exp}(\alpha_M\cdot\text{log}(K/S)^2+\alpha_t\cdot\Delta t)
+\sum_{T\in\text{Trades}_i}w_{\text{vol}}\cdot\text{Vol}_T\cdot\text{exp}(\beta|t-t_T|)
\end{equation}\]</div>
<p>in which <span class="arithmatex">\(\lambda_i(t)\)</span> is the intensity of event (in this case, contract) <span class="arithmatex">\(i\)</span> at time <span class="arithmatex">\(t\)</span>, and <span class="arithmatex">\(\mu\)</span> is the baseline intensity. The second term is the impact on being far/short ITM or OTM (<span class="arithmatex">\(\Delta t\)</span> is time-till-expiry in years), and the third iterates for all previous trades that occured for this contract <span class="arithmatex">\(i\)</span> by accounting for their volumes (higher volumes means more intensity) and for their time decays. <span class="arithmatex">\(\alpha_M\)</span>, <span class="arithmatex">\(\alpha_t\)</span> and <span class="arithmatex">\(w\)</span> are parameters.</p>
<p>We then compute the total intensity (accross all contracts):</p>
<p><span class="arithmatex">\(\Lambda(t)=\sum_{i}\lambda_i(t)\)</span></p>
<p>and then sample an amount of orders to generate by a Poisson process, with parameter <span class="arithmatex">\(\Lambda(t)\cdot\text{dt}\)</span>. This is the so-called discrete version of a Hawkes process..</p>
<p>The clear difference with cross-excitation models is that here we don't account for impact of other contract's orders, which is a modelling choice that simplifies the simulation.</p>
<h3 id="order-volume">Order volume</h3>
<p>We use the formula</p>
<p><span class="arithmatex">\(\text{Vol}=\text{Lognormal}(\mu,\sigma)\cdot\text{VolumeBase}\cdot\text{exp}(-\gamma\text{log}(K/S)-\beta\Delta t)\)</span></p>
<p>Here, <span class="arithmatex">\(\mu\)</span> and <span class="arithmatex">\(\sigma\)</span> determine the "randomness" of the order volume generation and the exponential factor determines the impact of moneyness and time decay, with <span class="arithmatex">\(\beta\)</span> being the time decay parameter, <span class="arithmatex">\(\gamma\)</span> the moneyness parameter, <span class="arithmatex">\(\text{log}(K/S)\)</span> the moneyness and <span class="arithmatex">\(\Delta t\)</span> the time till expiry in years.</p>
<h3 id="buy-and-limit-order-probability-distributions">Buy and limit order probability distributions</h3>
<p>For determining whether an order will be a buy or sell or a limit or not, we use a generalized linear model with the classic logistic function:</p>
<p><span class="arithmatex">\(p_{buy}=1/(1+\text{exp}(-\eta_{buy}))\)</span></p>
<p>and similarly for the limit order probability.</p>
<p>We determine the coefficients <span class="arithmatex">\(\eta_{buy}\)</span> and <span class="arithmatex">\(\eta_{limit}\)</span> by using simple linear regression:</p>
<p><span class="arithmatex">\(\eta_{buy}=\beta_0+\beta_1\cdot\text{Imbalance}\)</span></p>
<p><span class="arithmatex">\(\eta_{limit}=\alpha_0+\alpha_1\cdot\text{Volume}+\alpha_2\cdot\text{Imbalance}\)</span></p>
<p>Here, the buy probability depends only on the base rate and the volume imbalance of the current orderbook (higher imbalance towards buy side promotes more buy orders), and the limit probatility depends on the base rate, volume imbalance (more imbalance means higher amount of limit orders), and the volume of the trade (higher volume means more likely to be a market order, since large trades tend to be market orders).</p>
<h3 id="analysis">Analysis</h3>
<p>I've then built a simple Streamlit application to make graphs and such of all the data generated by the simulation.</p>
<h3 id="hawkes-cross-exciting-process">Hawkes cross-exciting process</h3>
<p>In this more complete version of the Hawkes process, we also account for the impact of the orders of other contracts on each contract. The formula we use here sums over all previous trades over all contracts instead of the contract we are considering itself:</p>
<div class="arithmatex">\[\begin{equation}
\begin{aligned}
\lambda_i(t)=\mu\cdot\text{exp}(\alpha_M\cdot\text{log}(K_i/S)^2+\alpha_t\cdot\Delta t_i)\\
+\sum_{j\in\text{Contracts}}\sum_{T\in\text{Trades}_j}(\rho_\text{self}1_{i=j}+\tau_{ij})w_{vol}\text{Vol}_T
\cdot\text{exp}(-\gamma_m|\Delta M|-\gamma_t|\Delta t|-\beta|t-t_T|)
\end{aligned}
\end{equation}\]</div>
<p>where</p>
<p><span class="arithmatex">\(\Delta M=\text{log}(K_j/S)-\text{log}(K_i/S)\)</span></p>
<p>and</p>
<p><span class="arithmatex">\(\Delta t=T_{i}^\text{expiry}-T_{j}^\text{expiry}\)</span></p>
<p>This equation accounts for the following things. The first term is the static intensity, depending on the moneyness and expiry date of the contract. The second accounts for the impact over all trades over all contracts. Within the sum, we account for the order's volume, the difference in moneynesses between contracts, the difference in expiry time and how long ago each trade was. We also account for self-excitation: <span class="arithmatex">\(\rho_{self}\)</span> boosts intensity if we encounter the contract itself in the sum, and we also account for the difference in impact between put- and call contracts by multiplying by <span class="arithmatex">\(\tau_{ij}\)</span>.</p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": ".", "features": [], "search": "assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>